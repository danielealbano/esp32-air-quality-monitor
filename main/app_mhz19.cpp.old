#include "freertos/FreeRTOS.h"
#include "esp_log.h"
#include "driver/uart.h"

#include "mhz19.h"

#include "app_mhz19.h"
#include "support.h"

static const char* TAG = "APP/MHZ19";
static int co2 = 0;
static int temp = 0;

extern "C" int app_mhz19_get_co2()
{
	return co2;
}

extern "C" int app_mhz19_get_temp()
{
	return temp;
}

extern "C" void app_mhz19_task(void* mhz19_p)
{
	MHZ19* mhz19 = (MHZ19*)mhz19_p;

	uint32_t get_data_millis = millis();

	while (1)
	{
		vTaskDelay(pdMS_TO_TICKS(50));

		if (millis() - get_data_millis >= 2000)
		{
			co2 = mhz19->getCO2();
			temp = mhz19->getTemperature();

			ESP_LOGI(TAG, "CO2: %d", co2);
			ESP_LOGI(TAG, "Temperature: %d", temp);

			get_data_millis = millis();
		}
	}
}
